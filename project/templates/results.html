{% extends "index.html" %}

{% block title %}Search Results{% endblock %}

{% block head %}
    <!-- {{ super() }} -->
    
        <!-- Add Bootstrap CSS  -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

        <style>
        .pagination {
            text-align: center;
        }
        .pagination a {
            display: inline-block;
            padding: 5px 10px;
            border: 1px solid #fb1414;
            margin: 0 5px;
            text-decoration: none;
        }
        .pagination a:hover {
            background: #eee;
        }

        /* style checkboxes as radio buttons */
        .custom-checkbox .custom-control-input:checked ~ .custom-control-label::before {
            background-color: blue;
            border-color: black;
            box-shadow: 0 0 0 2px white inset;
        }

        input[type="checkbox"]{
            visibility: hidden;
            position: absolute;
        }

        input[type="checkbox"] + label::before{
            height: 12px;
            width: 12px;
            margin-right: 2px;
            content: " ";
            display: inline-block;
            vertical-align: baseline;
            border: 1px solid #777;
            border-radius: 50%;
        }
    </style>
{% endblock %}

{% block content %}
{% set colors = ['#FF5733', '#C70039', '#900C3F', '#581845', '#5DADE2', '#48C9B0', '#FFC300', '#FF5733', '#C70039'] %}
    <h1>Search Results</h1>
    {% for row in table %}
    <div class="search-result">
      <!-- <img src="{{ row.icon }}" alt="Document icon" class="icon"> -->
      <div class="result-info">
        <h3>{{ row.title }}</h3>
        <p class="abstract">{{ row.abstract }}</p>
        <div class="keywords">
            {% for keyword in row.subject_topic %}
            <div class="custom-control custom-checkbox">
                <input type="checkbox" class="custom-control-input keyword-checkbox" id="{{ keyword }}" value="{{ keyword }}" >
                <label class="custom-control-label" for="{{ keyword }}">{{ keyword }}</label>
            </div>
            {% endfor %}
        </div>
      </div>
    </div>
  {% endfor %}
  
     <!-- pagination -->
    {% if num_rows > per_page %}
    <div class="pagination">
        {% if page > 1 %}
        <a href="?page={{ page - 1 }}">&laquo; Previous</a>
        {% endif %}

        {% if page * per_page < num_rows %}
        <a href="?page={{ page + 1 }}">Next &raquo;</a>
        {% endif %}
    </div>
    {% endif %}

    <!-- Add Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    
    <!-- Clear selectedKeywords localStorage variable on a new search -->
    {% if new_search %}
    <script>
        localStorage.removeItem("selectedKeywords");
    </script>
    {% endif %}

    <!-- Add JavaScript to handle checkbox selection -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            let selectedKeywords = new Set(JSON.parse(localStorage.getItem("selectedKeywords")) || []);

            function updateCheckboxes() {
                document.querySelectorAll(".keyword-checkbox").forEach(function (checkbox) {
                    checkbox.checked = selectedKeywords.has(checkbox.value);
                });
            }

            function storeSelectedKeywords() {
                localStorage.setItem("selectedKeywords", JSON.stringify(Array.from(selectedKeywords)));
            }

            document.querySelectorAll(".keyword-checkbox").forEach(function (checkbox) {
                checkbox.addEventListener("change", function () {
                    if (checkbox.checked) {
                        selectedKeywords.add(checkbox.value);
                    } else {
                        selectedKeywords.delete(checkbox.value);
                    }

                    if (selectedKeywords.size > 9) {
                        checkbox.checked = false;
                        selectedKeywords.delete(checkbox.value);
                    }

                    updateCheckboxes();
                    storeSelectedKeywords();
                });
            });

            updateCheckboxes();
        });
    </script>
{% endblock %}